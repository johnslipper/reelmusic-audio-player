//@codekit-append "TapeMachine.js";
//@codekit-append "Tape.js";
/* **********************************************
     Begin TapeMachine.js
********************************************** */var TapeMachine=new Class({Implements:[Options,Events],tape:null,degrees:0,direction:"anti",playback:"pause",position:0,multiplier:null,duration:null,volume:50,playbackTimer:null,leftReel:null,rightReel:null,leftTape:null,rightTape:null,spoolSound:null,startSound:null,moveSound:null,animate:!1,options:{volume:null,leftReelID:"leftReel",rightReelID:"rightReel",leftTapeID:"leftTape",rightTapeID:"rightTape",leftStripID:"leftTapeStrip",rightStripID:"rightTapeStrip",reelSize:234,tapeSize:155,tapeOffset:65,spinSpeed:5,leftStripLimits:[-66,-29],rightStripLimits:[31,69],spoolSound:"audio/reel-load",startSound:"audio/reel-start",fastSound:"audio/reel-fast",fxVolume:30,animate:!0},initialize:function(e,t){this.setOptions(t);if(!buzz.isSupported())this.fireEvent("failure");else{this.multiplier=this.options.spinSpeed;this.leftReel=$(this.options.leftReelID);this.rightReel=$(this.options.rightReelID);this.leftTape=$(this.options.leftTapeID);this.rightTape=$(this.options.rightTapeID);this.leftStrip=$(this.options.leftStripID);this.rightStrip=$(this.options.rightStripID);this.options.animate?this._animationTest():this.animate=!1;this._setupFX();e&&this.spool(e);if(this.options.volume){this.volume=this.options.volume;this.setVolume()}}},_animationTest:function(){var e=!1,t="animation",n="",r="Webkit Moz O ms Khtml".split(" "),i="";this.leftReel.style.animationName&&(e=!0);if(e===!1)for(var s=0;s<r.length;s++)if(this.leftReel.style[r[s]+"AnimationName"]!==undefined){i=r[s];t=i+"Animation";n="-"+i.toLowerCase()+"-";e=!0;break}e&&(this.animate=!0)},_setupFX:function(){this.spoolSound=new Tape(this.options.spoolSound,{preload:!0,volume:this.options.fxVolume});this.startSound=new Tape(this.options.startSound,{preload:!0,volume:this.options.fxVolume});this.fastSound=new Tape(this.options.fastSound,{preload:!0,volume:this.options.fxVolume,loop:!0})},_rotateElement:function(e,t){if(e){t==undefined&&(t=0);Browser.ie?e.style.msTransform="rotate("+t+"deg)":e.setStyles({"-moz-transform":"rotate("+t+"deg)","-ms-transform":"rotate("+t+"deg)","-o-transform":"rotate("+t+"deg)","-webkit-transform":"rotate("+t+"deg)",transform:"rotate("+t+"deg)"})}},_rotateReels:function(e){e!=undefined&&(this.degress=e);this.degrees<=0&&(this.degrees=360);this.degrees>=360&&this.direction=="clock"&&(this.degrees=0);this._rotateElement(this.leftReel,this.degrees);this._rotateElement(this.rightReel,this.degrees);this.degrees=this.direction=="clock"?this.degrees+this.multiplier:this.degrees-this.multiplier},_rotateTapeStrips:function(){var e=this.options.leftStripLimits,t=this.options.rightStripLimits,n=e[0]+(e[1]-e[0])/100*this.position,r=t[0]+(t[1]-t[0])/100*this.position;this._rotateElement(this.leftStrip,n);this._rotateElement(this.rightStrip,r)},_setElementSize:function(e,t){if(e&&t!=undefined){var n=(this.options.reelSize-t)/2;e.setStyles({height:t,width:t,"margin-left":n,"margin-top":n})}},_setElementScale:function(e,t){e&&t!=undefined&&e.setStyles({"-moz-transform":"scale("+t+")","-ms-transform":"scale("+t+")","-o-transform":"scale("+t+")","-webkit-transform":"scale("+t+")",transform:"scale("+t+")"})},_resizeTape:function(){var e=this.options.tapeSize/100,t=e*this.position+this.options.tapeOffset,n=this.options.tapeSize-e*this.position+this.options.tapeOffset;this._setElementSize(this.leftTape,n);this._setElementSize(this.rightTape,t)},_beginPlayback:function(){if(this.playbackTimer)return;var e=this;this.playbackTimer=setInterval(function(){e.animate||e._rotateReels();e._setPosition();e._rotateTapeStrips();(e.position>=100||e.position<0)&&e.pause()},50)},_pausePlayback:function(){clearInterval(this.playbackTimer);this.playbackTimer=null},_setPosition:function(){this._resizeTape();this._rotateTapeStrips();var e=this.tape.getDuration()/100*this.position;if(this.playback=="rw"){this.position-=1;this.tape.setPosition(e)}else if(this.playback=="ff"){this.position+=1;this.tape.setPosition(e)}else this.position=this.tape.getPercent()},_checkTape:function(){if(!this.tape){alert("Please Load a Tape");return!1}return!0},_animateReels:function(e){var e=e||"";this.leftReel.setProperty("class",e);this.rightReel.setProperty("class",e)},eject:function(){this.pause();this.fireEvent("eject",this.tape);this.tape.stop();this.tape=null;this.position=0},spool:function(e){var t=this;if(!e){this._checkTape();return}if(this.tape===e)return;this.tape&&this.eject();this.tape=e;this.tape.load();this.setVolume();this.spoolSound.play();this.fireEvent("spool",this.tape);this.tape.addEvent("ready",function(){t.fireEvent("ready",t.tape);t._setPosition()})},play:function(){if(!this._checkTape())return;if(this.playback!="play"){this.animate&&this._animateReels("reverse normal");this.tape.play();this.direction="anti";this.multiplier=this.options.spinSpeed;this.playback="play";this._beginPlayback();this.startSound.play();this.fastSound.pause();this.fireEvent("play")}},pause:function(){if(!this._checkTape())return;if(this.playback!="pause"){this.animate&&this._animateReels("reverse stop");this.tape.pause();this.playback="pause";this._pausePlayback();this.startSound.play();this.fastSound.pause();this.fireEvent("pause")}},rewind:function(){if(!this._checkTape())return;if(this.playback!="rw"&&this.position!=0){this.pause();this.multiplier=20;this.direction="clock";this.tape.pause();if(this.playback!="play"){this.animate&&this._animateReels("forward fast");this.playback="rw";this._beginPlayback();this.fastSound.play()}}},fastforward:function(){if(!this._checkTape())return;if(this.playback!="ff"&&this.position!=100){this.pause();this.multiplier=20;this.direction="anti";this.tape.pause();if(this.playback!="play"){this.animate&&this._animateReels("reverse fast");this.playback="ff";this._beginPlayback();this.fastSound.play()}}},setVolume:function(e){e!=undefined&&(this.volume=e);this.tape&&this.tape.setVolume(this.volume)}}),Tape=new Class({Implements:[Options,Events],audio:null,duration:null,title:null,artist:null,album:null,download:null,website:null,options:{title:null,artist:null,album:null,download:null,preload:!1,loop:!1,volume:100},initialize:function(e,t){if(!e){alert("Please Provide Audio Path");return}this.setOptions(t);this.audioPath=e;if(!buzz.isSupported())this.fireEvent("failure");else{this.options.title&&(this.title=this.options.title);this.options.artist&&(this.artist=this.options.artist);this.options.album&&(this.album=this.options.album);this.options.download&&(this.download=this.options.download);this._makeAudio()}},_makeAudio:function(){var e=this;if(!this.audioPath){alert("Error - No Audio Path");return}var t="metadata";this.options.preload&&(t=!0);this.audio=new buzz.sound(this.audioPath,{formats:["mp3","ogg"],preload:t,loop:this.options.loop});this.setVolume(this.options.volume);this.audio.bind("canplaythrough",function(){e.fireEvent("ready")})},load:function(){this.audio.load()},play:function(){this.audio.play()},pause:function(){this.audio.pause()},stop:function(){this.audio.stop()},loop:function(){this.audio.loop()},unloop:function(){this.audio.unloop()},setVolume:function(e){if(e===undefined)var e=50;this.audio.setVolume(e)},setPosition:function(e){var e=e||0;this.audio.setTime(e)},getPosition:function(){return this.audio.getTime()},getPercent:function(){return this.audio.getPercent()},setPercent:function(e){var e=e||0;this.audio.setPercent(e)},getDuration:function(){return this.audio.getDuration()}});